# djembe-score

西アフリカトラディショナル譜面作成アプリ
ジェンベ（西アフリカの太鼓）の譜面を作成するWebアプリケーション

## 基本情報

- **対象楽器**: ジェンベ（西アフリカの太鼓）
- **実装形式**: 静的HTML（Vanilla JavaScript）
- **再生機能**: なし（視覚的な譜面作成のみ）

## 音の種類と記号

### 基本音（8種類）

| 音名 | 記号 | 種類 |
|------|------|------|
| ベース | □ | 中抜き四角 |
| トーン | ○ | 中抜き丸 |
| スラップ | △ | 中抜き三角 |
| ベース（ミュート） | ■ | 塗りつぶし四角 |
| トーン（ミュート） | ● | 塗りつぶし丸 |
| スラップ（ミュート） | ▲ | 塗りつぶし三角 |
| ロール | ≡ | 三本線（汎用） |
| フラム | ≈ | 波線（汎用） |

**ルール**:
- 通常音は中抜き、ミュート音は塗りつぶし
- ロール・フラムは音色を区別せず、汎用記号で表現
- すべての記号は1マスに1つ配置（統一的な扱い）

## 譜面構造

### グリッド構成

- **1行 = 2小節**
- **各小節は独立して4連または3連を設定可能**

#### 例1: 両小節とも4連の場合
```
[小節1: □ □ □ □] [小節2: □ □ □ □]
     4連              4連
1行 = 8マス
```

#### 例2: 小節1が4連、小節2が3連の場合
```
[小節1: □ □ □ □] [小節2: □ □ □]
     4連              3連
1行 = 7マス
```

#### 例3: 両小節とも3連の場合
```
[小節1: □ □ □] [小節2: □ □ □]
     3連           3連
1行 = 6マス
```

### 小節構成の設定

- 各小節ごとに個別に「4連」または「3連」を選択可能
- 小節ごとの設定により、1行のマス数が動的に変化
- 小節の区切りは太い縦線で表示

## パート管理

- **最大パート数**: 4パート
- **パート名**: 編集可能（テキストボックスをクリックして変更）
- **パート操作**: 追加・削除が可能
- **行数**: 各パートで自由に行を追加可能

## UI機能

### 記号選択パレット

- **セクションラベル**: 「音の種類」
- **選択状態表示**:
  - 選択中の記号は太い紫枠（4px）でハイライト
  - 光彩効果で視認性向上
  - ホバー時は拡大表示

### 譜面欄

- **セクションラベル**: 「譜面欄」
- **ビートグループハイライト**:
  - クリックした小節全体（4連または3連）を黄色でハイライト
  - 記号配置後も選択状態を維持
  - 視覚的に現在の操作対象を明示

### 小節構成切り替えUI

- 各行の各小節ごとに「4連/3連」切り替えボタンを配置
- クリックで瞬時に切り替え可能
- グリッドは自動的に再描画

## 操作方法

### 基本操作

1. **記号選択**: パレットから記号をクリック（太枠で選択状態を表示）
2. **記号配置**: グリッド上のセルをクリックで配置
3. **記号削除**: 配置済みの記号をクリックで削除
4. **連続配置**: 記号選択後、複数のセルに連続して配置可能

### 小節構成の変更

1. 各小節の切り替えボタンをクリック
2. 4連 ⇔ 3連 を切り替え
3. グリッドが自動的に調整される

### パート管理

1. **パート追加**: 「パート追加」ボタンをクリック
2. **パート削除**: 各パートの「削除」ボタンをクリック
3. **パート名変更**: パート名のテキストボックスをクリックして編集
4. **行追加**: 各パートの「+ 行を追加」ボタンをクリック

## データ保存

### LocalStorage（自動保存）

- 記号配置、パート構成、小節設定を自動的にLocalStorageに保存
- ブラウザを閉じても、同じブラウザであればデータが保持される

### JSONファイル保存

- **保存**: 「保存」ボタンでJSON形式でダウンロード
- **読込**: 「読込」ボタンでJSONファイルをアップロード
- **形式**:
```json
{
  "parts": [
    {
      "name": "パート1",
      "rowConfigs": [
        { "beats": [4, 4] },  // 1行目: 小節1=4連, 小節2=4連
        { "beats": [4, 3] },  // 2行目: 小節1=4連, 小節2=3連
        { "beats": [3, 3] }   // 3行目: 小節1=3連, 小節2=3連
      ],
      "notes": {
        "0": "□",   // position 0 にベース
        "4": "●"    // position 4 にトーン（ミュート）
      }
    }
  ]
}
```

## 技術仕様

### データ構造

#### パート構造
```javascript
{
  id: number,              // パートID
  name: string,            // パート名（編集可能）
  rowConfigs: [            // 各行の小節構成
    {
      beats: [4, 4]        // [小節1の連数, 小節2の連数]
    }
  ],
  notes: {                 // 記号配置（positionは累積計算）
    "0": "□",
    "4": "●"
  }
}
```

#### Position計算

- 累積方式：前の行までのマス数を加算
- 例:
  - 1行目が8マス（4+4）、2行目が7マス（4+3）の場合
  - 2行目の最初のセル = position 8
  - 2行目の5番目のセル = position 12

### ブラウザ対応

- モダンブラウザ（Chrome, Firefox, Safari, Edge）
- LocalStorage対応ブラウザ
- UTF-8記号の表示対応

## 今後の拡張可能性

- 音声再生機能の追加
- PDF出力機能
- 印刷最適化
- より多様な特殊奏法の表現
- テンポ設定機能
